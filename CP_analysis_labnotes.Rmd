---
title: "Labnotes on CP analysis"
output:
  pdf_document: default
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: console
---


```{r startup}

library(tidyverse)
library(readxl)
library(rcdk)
library(enviPat)
library(reticulate)

data("isotopes")
data("adducts")

Cl_adducts <- readxl::read_xlsx("./data/CP_adducts.xlsx") %>%
        mutate(Formula_add = as.character(Formula_add))

adducts <- adducts %>% bind_rows(Cl_adducts)

#library(iterpc)
#library(IsoSpecR)

```


__Papers__:  
- Method validation and comparison of quantification strategies for analysis of chlorinated paraffins in indoor dust by liquid chromatography and high-resolution mass spectrometry. 10.20517/jeea.2021.10  
- The impact of baking on chlorinated paraffins: Characterization of C10–C17 chlorinated paraffins in oven-baked pastry products and unprocessed pastry dough by HPLC–ESI–Q–TOF–MS. https://doi.org/10.1016/j.foodchem.2019.125100  

__Github__:  
- https://github.com/ingusperkons/CP-Crawler  

# Test Perkons
```{r}

data_perkons <- read_excel("data/Perkons_CP_calibration_multiple_chains.xlsx", sheet = "test")
data_perkons_long <- data_perkons |> 
        pivot_longer(cols = )

area <- data_perkons |> select(C1_area:C8_area) |> slice(4)

lm.fit()

```



# Quantification according to Yuan et al

```{r quant_yuanbo}
# Quantifying Short-Chain Chlorinated Paraffin Congener Groups


C = 9
Cl = 5



```


# test Hungarian algorithm
```{r hungarian}

set.seed(593903)

library(RcppHungarian)
library(ggplot2)

# humans are rows (5), dogs are columns (4)
cost <- rbind(c(1,5,2,19), 
              c(4,0,3,10), 
              c(6,9,6,1), 
              c(9,8,1,3), 
              c(6,1,1,1))
HungarianSolver(cost)

```

```{python}
library(reticulate)
import pandas
py_install("rdkit")
from rdkit import Chem
from rdkit.Chem.EnumerateStereoisomers import EnumerateStereoisomers, StereoEnumerationOptions
m = Chem.MolFromSmiles('BrC=CC1OC(C2)(F)C2(Cl)C1')
isomers = tuple(EnumerateStereoisomers(m))
len(isomers)

```


# Old notes


# Optimization of GC-ECNI-orbitrap-HRAMS for CPs

For SCCPs: the different electron energies and CI gas shows that the optimum parameters are: 70 eV with 1.5 ml/min methane gas. According to Thermo technical 

```{r, echo=FALSE}

gasvsev <- read_xlsx("D:/Projects/Formas_CPs_indoor/Experimental/2021/20210802_ECNI_optimization_params.xlsx", 
                     sheet = "CIgas_vs_Area") %>%
        mutate(Cigas = as.factor(Cigas), eV = as.factor(eV)) %>%
        pivot_longer(cols = where(is.numeric), names_to = "Congener_group", values_to = "Area")

gasvsev %>%
        ggplot(aes(x = Congener_group, y = Area)) +
        geom_bar(aes(fill = eV), stat = "identity", position=position_dodge()) +
        facet_grid(~Cigas, labeller = label_both) +
        theme_bw() +
        theme(axis.text.x = element_text(angle = 90))
        


```


Calibration of 5 ppm SCCPs

```{r, echo=FALSE}

sccp <- read_xlsx("D:/Projects/Formas_CPs_indoor/Experimental/2021/20210802_ECNI_optimization_params.xlsx", 
                     sheet = "20210803_cal5ppm") %>%
        mutate(perc_Cl = as.factor(perc_Cl)) %>%
        pivot_longer(cols = C10Cl5:C13Cl9, names_to = "Congener_group", values_to = "Area")

sccp %>%
        ggplot(aes(x = Congener_group, y = Area)) +
        geom_bar(aes(fill = Congener_group), stat = "identity", position=position_dodge()) +
        facet_grid(~perc_Cl, labeller = label_both) +
        theme_bw() +
        theme(axis.text.x = element_text(angle = 90))
        


```






