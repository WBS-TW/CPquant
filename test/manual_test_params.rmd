---
output: html_document
editor_options: 
  chunk_output_type: console
---

#---START----Test params for Skyline----START---------- 
Test PCA

```{r}

library(shiny)
library(shinythemes)
library(DT)
library(tidyverse)
library(readxl)
library(plotly)
library(crosstalk)
library(enviPat)
library(markdown)

data("isotopes")
source("./shinyCP/R/getAdduct.R")
source("./shinyCP/R/getSkyline.R")
source("./shinyCP/R/getAdduct_BCA.R")
source("./shinyCP/R/getSkyline_BCA.R")
source("./shinyCP/R/generateInput_Envipat.R")


Cmin <- 10
Cmax  <- 12
Clmin <- 1
Clmax <- 4
Brmin <- 1
Brmax <- 3
Br <- as.integer(Brmin:Brmax)
#Adduct <- "[PCA+Cl]-"
Adduct <- "[PCA-2Cl-HCl]-"
threshold <- 5
MSresolution <- 60000

C <- as.integer(Cmin:Cmax)
Cl <- as.integer(Clmin:Clmax)
selectedAdducts <- Adduct
Adducts <- as.character(selectedAdducts)
i <- 1
adduct_ions = Adducts[i]






```


Test PCO

```{r}

library(shiny)
library(shinythemes)
library(DT)
library(tidyverse)
library(readxl)
library(plotly)
library(crosstalk)
library(enviPat)
library(markdown)

data("isotopes")
source("./shinyCP/R/getAdduct.R")
source("./shinyCP/R/getSkyline.R")
source("./shinyCP/R/getAdduct_BCA.R")
source("./shinyCP/R/getSkyline_BCA.R")
source("./shinyCP/R/generateInput_Envipat.R")


Cmin <- 10
Cmax  <- 12
Clmin <- 1
Clmax <- 4
Brmin <- 1
Brmax <- 3
Br <- as.integer(Brmin:Brmax)
Adduct <- "[PCO+Cl]-"
threshold <- 5
MSresolution <- 60000

C <- as.integer(Cmin:Cmax)
Cl <- as.integer(Clmin:Clmax)
selectedAdducts <- Adduct
Adducts <- as.character(selectedAdducts)
i <- 1
adduct_ions = Adducts[i]






```



test bromochloroalkanes
```{r}

library(shiny)
library(shinythemes)
library(DT)
library(tidyverse)
library(readxl)
library(plotly)
library(crosstalk)
library(enviPat)
library(markdown)

data("isotopes")
source("./shinyCP/R/getAdduct.R")
source("./shinyCP/R/getSkyline.R")
source("./shinyCP/R/getAdduct_BCA.R")
source("./shinyCP/R/getSkyline_BCA.R")
source("./shinyCP/R/generateInput_Envipat.R")


Cmin <- 10
Cmax  <- 12
Clmin <- 1
Clmax <- 4
Brmin <- 1
Brmax <- 3
Adduct <- "[BCA+Cl]-"
threshold <- 2
MSresolution <- 60000

C <- as.integer(Cmin:Cmax)
Cl <- as.integer(Clmin:Clmax)
Br <- as.integer(Brmin:Brmax)
selectedAdducts <- Adduct
Adducts <- as.character(selectedAdducts)
i <- 1
adduct_ions = Adducts[i]




```



Skyline tab
```{r}


CP_allions_skyline <- CP_allions %>%
                                mutate(`Molecule List Name` = case_when(str_detect(
                                        Adduct, "(?<=.)PCA(?=.)") == TRUE ~ paste0("PCA-C", str_extract(Molecule_Formula, "(?<=C)\\d+(?=H)"))))      
                



```



Test new advanced settings
```{r}
library(shiny)
library(shinythemes)
library(DT)
library(tidyverse)
library(readxl)
library(plotly)
library(crosstalk)
library(enviPat)
library(markdown)

data("isotopes")
source("./shinyCP/R/getAdduct.R")
source("./shinyCP/R/getSkyline.R")
source("./shinyCP/R/getAdduct_BCA.R")
source("./shinyCP/R/getSkyline_BCA.R")
source("./shinyCP/R/generateInput_Envipat.R")

selectedCompounds <- "PCA"
selectedAdducts <- "+Cl"
selectedIonization <- "-"
#selectedTP <- "None"
selectedTP <- "+OH"

Cmin <- 10
Cmax  <- 12
Clmin <- 1
Clmax <- 4
Brmin <- 1
Brmax <- 3
Br <- as.integer(Brmin:Brmax)

threshold <- 5
MSresolution <- 60000

i <- 1

C <- as.integer(Cmin:Cmax)
Cl <- as.integer(Clmin:Clmax)

Compounds <- as.character(selectedCompounds)
Adducts <- as.character(selectedAdducts)
Ionization <- as.character(selectedIonization)
TP <- as.character(selectedTP)

Molecule_Annotation <- case_when(
        TP == "None" ~ paste0("[", Compounds, Adducts, "]", Ionization),
        TRUE ~ paste0("[", Compounds, TP, Adducts, "]", Ionization)
)

adduct_ions = Adducts[i]


```




      